from plptest import *

TestConfig = c = {}

def check_output_fc(config, output):

  if output.find('==== FC: SUMMARY: SUCCESS') == -1:
    return (False, "Didn't find output string")

  return (True, None)


def check_output_cl(config, output):

  if output.find('==== CLUSTER: SUMMARY: SUCCESS') == -1:
    return (False, "Didn't find output string")

  return (True, None)

test_cluster = Test(
  name = 'testFPU_cluster',
  commands = [
    Shell('conf', 'make conf cluster=1 build_dir_ext=_cluster'),
    Shell('clean', 'make clean cluster=1 build_dir_ext=_cluster'),
    Shell('build', 'make all cluster=1 build_dir_ext=_cluster'),
    Shell('run',   'make run cluster=1 build_dir_ext=_cluster'),
    Check('check', check_output_cl)
  ],
  timeout=1000000,
  restrict='config.get("**/pe") != None'
)
  
test_fc = Test(
  name = 'testFPU_fc',
  commands = [
    Shell('conf', 'make conf'),
    Shell('clean', 'make clean'),
    Shell('build', 'make all'),
    Shell('run',   'make run'),
    Check('check', check_output_fc)
  ],
  timeout=1000000,
  restrict='config.get("**/fc") != None'
)
  
c['tests'] = [ test_fc, test_cluster ]
